<!DOCTYPE html>
<html>
<head>
    <title>Ch·ªçn m·ª•c ki·ªÉm tra</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <style>
    /* -- GI·ªÆ NGUY√äN TO√ÄN B·ªò CSS B·∫†N ƒê√É C√ì -- */
    :root {
        --main-bg: #fffdfc;
        --main-card: #fffdfccf;
        --main-text: #25312b;
        --main-th: #c49c48;
        --main-border: #d8d8cc;
        --color-green: #4e8573;
        --color-bronze: #8B6B1E;
        --color-brown: #6B4F1A;
        --color-red-metallic: #A32121;
        --color-pass: #2E7D32;
        --color-fail: var(--color-red-metallic);
        --color-na: #666666;
        --color-text-dark: #25312b;
        --color-text-light: #F9F7F0;
        --shadow-dark: rgba(255, 255, 255, 0.15);
        --shadow-light: rgba(0,0,0,0.12);
        --warn-bg-dark: #f3d5d5;
        --warn-text-dark: #db4545;
    }
    body.dark, .dark {
        --main-bg: #2b3938;
        --main-card: #374B4A;
        --main-text: #f6f6ef;
        --main-th: #ffe082;
        --main-border: #263d3a;
        --color-green: #91b8a2;
        --color-bronze: #ffc970;
        --color-brown: #bfa87b;
        --color-na: #aaa;
        --color-text-dark: #f6f6ef;
        --color-text-light: #f6f6ef;
    }
    html, body {
        height: 100%; margin: 0; padding: 0;
        background: var(--main-bg);
        color: var(--main-text);
        font-family: 'Open Sans', Arial, sans-serif;
        transition: color 0.2s, background 0.22s;
    }
    body.dark, .dark { color: var(--color-text-light); }
    .report-banner {
        color: #d6c49d; font-size: 21px; font-weight: bold;
        text-align: center; margin-top: 6px; margin-bottom: 14px;
        letter-spacing: 1px; text-shadow: 0 2px 14px #c49c484a;
        font-family: 'Merriweather', serif;
    }
    .f2057-panel > div {
        margin-bottom: 12px;
    }
    .box {
        background: var(--main-card); color: var(--main-text);
        max-width: 540px; margin: 10px auto 0 auto;
        padding: 28px 20px 30px 20px; border-radius: 16px;
        box-shadow: 0 4px 24px var(--shadow-light); position: relative;
        transition: background 0.22s, color 0.2s;
        font-family: 'Open Sans', Arial, sans-serif;
    }
    body.dark .box { background: var(--main-card); box-shadow: 0 4px 24px var(--shadow-dark); color: var(--main-text); }
    h2 {
        font-family: 'Merriweather', serif; color: var(--color-green);
        text-align: center; margin-bottom: 32px; font-size: 26px; font-weight: 700;
        letter-spacing: 0.12em; transition: color 0.21s; text-shadow: none;
    }
    body.dark h2 { color: var(--main-th); text-shadow: 1px 1px 5px rgba(0,0,0,0.6); }
    .back-btn-container {
        text-align: left;
        margin-bottom: 6px;
        margin-top: 0;
    }
    .back-btn {
        background: #faf7ec;
        color: #73592c !important;
        border: 1px solid #d5c69d;
        border-radius: 11px;
        font-family: 'Inter', 'Open Sans', Arial, sans-serif;
        font-size: 13.3px;
        font-weight: 600;
        letter-spacing: 0.03em;
        padding: 4px 12px 4px 11px;
        min-width: 0;
        box-shadow: 0 1px 6px #d4c8942a;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 7px;
        transition: background 0.13s, color 0.13s, border-color 0.13s;
    }
    .back-btn:hover {
        background: #ffe082;
        color: #25312b !important;
        border-color: #ffe082;
    }
    .back-btn svg {
        margin: 0 !important;
    }
    .test-group-menu { display: flex; flex-direction: column; gap: 16px; margin: 0 0 16px 0; }
    .test-group-menu > div { width: 100%; }
    .test-btn {
        background: var(--color-green); color: #fff8b0; border: none; border-radius: 12px;
        font-size: 17px; font-weight: 600; text-align: left; padding: 14px 20px;
        box-shadow: 0 2px 10px var(--shadow-light); cursor: pointer;
        transition: background 0.22s, color 0.15s, transform 0.15s;
        margin: 0; min-height: 58px; display: flex; align-items: center; justify-content: flex-start;
        outline: none; position: relative; overflow: hidden; letter-spacing: 0.3px; line-height: 1.35;
        word-break: break-word; word-wrap: break-word; text-decoration: none;
        font-family: 'Inter', sans-serif;
    }
    body.dark .test-btn { background: var(--color-green); color: #25312b; box-shadow: 0 2px 10px var(--shadow-dark); }
    .test-btn:hover { background: var(--color-bronze); }
    .test-btn b {
        font-weight: 700; margin-right: 8px; white-space: nowrap;
        font-family: 'Merriweather', serif; color: #fff8b0; transition: color 0.22s;
    }
    body.dark .test-btn b { color: #25312b; }
    .status-block {
        font-size: 14px; text-align: left; padding-left: 12px; color: var(--color-green);
        user-select: none; margin-top: 6px; font-family: 'Open Sans', Arial, sans-serif;
        font-weight: 500; font-style: italic;
    }
    body.dark .status-block { color: var(--main-th); }
    .result-pass, .result-fail, .result-na, .comment {
        padding: 4px 8px; border-radius: 10px; box-shadow: 0 3px 7px var(--shadow-light);
        display: inline-block; max-width: 95%; word-break: break-word; font-weight: 700;
        transition: background 0.22s, color 0.22s; font-family: 'Inter', sans-serif;
    }
    body.dark .result-pass, body.dark .result-fail, body.dark .result-na, body.dark .comment {
        box-shadow: 0 3px 8px var(--shadow-dark);
    }
    .result-pass { background: var(--color-green); border: 1.6px solid var(--color-pass); color: #fff; }
    body.dark .result-pass { background: var(--color-green); border-color: var(--color-green); color: var(--main-th); }
    .result-fail { color: var(--color-beige-bg); border: 1.6px solid var(--color-fail); background: var(--color-fail); font-weight: 800; }
    body.dark .result-fail { background: #712626; border-color: #712626; color: var(--color-beige-bg); }
    .result-na { color: var(--color-na); border: 1.6px solid var(--color-na); background: #e6e6e6; }
    body.dark .result-na { background: #4a6151; border-color: #4a6151; color: var(--color-beige-bg); }
    .comment { color: #2276a7; background: #eaf4fb; border: 1.5px solid #6ca7ce; font-size: 13px; margin-top: 4px; }
    body.dark .comment { border-color: #9ac4e7; background: #425a70; color: #c7d7ff; }
    .img-warn {
        color: var(--color-fail); font-size: 13px; font-weight: 900; margin-top: 6px; padding: 2px 8px;
        border-radius: 8px; background: var(--warn-bg-dark); border: 1.5px solid var(--color-fail);
        box-shadow: 0 0 8px var(--color-fail); display: inline-block; user-select: none; font-family: 'Open Sans', Arial, sans-serif;
    }
    body:not(.dark) .img-warn { background: #fbdcdc; border-color: #db6e6e; box-shadow: 0 0 6px #db6e6eaa; color: #b61e1e; }
    .update-status {
        font-size: 13px; padding: 5px 12px; border-radius: 10px; background: var(--color-light-gray);
        color: var(--color-brown); box-shadow: 0 1px 5px var(--shadow-light); user-select: none; font-weight: 600; font-style: italic; letter-spacing: 0.05em; margin-top: 6px; transition: background 0.2s, color 0.2s; font-family: 'Open Sans', Arial, sans-serif;
    }
    body.dark .update-status { background: #3b4a3f; color: var(--color-beige-bg); box-shadow: 0 1px 5px var(--shadow-dark); }
    .ripple { position: absolute; border-radius: 50%; transform: scale(0); animation: ripple 0.33s cubic-bezier(0.39, 0.58, 0.57, 1); background: rgba(255,255,255,0.27); pointer-events: none; z-index: 10; opacity: 0.76; }
    @keyframes ripple { to { transform: scale(1.5); opacity: 0; } }
    #theme-btn {
      position: fixed; right: 24px; bottom: 26px; z-index: 11001; background: var(--color-bronze); color: #fff;
      border-radius: 100px; font-size: 17px; padding: 6px 11px; border:none;
      box-shadow: 0 2px 10px var(--shadow-light); cursor:pointer; transition: background 0.16s;
      height: 38px; width: 38px; min-width:36px; display:flex;align-items:center;justify-content:center; opacity:0.96;
    }
    #theme-btn:hover { background: var(--color-brown); color: #fff; opacity:1; }
    body.dark #theme-btn { background: #6c837f; color: #ffe082; }
    body.dark #theme-btn:hover { background: #b78e24; color: #fff; }
    /* Accordion style cho F2057 */
    .f2057-panel { margin: 0 0 12px 0; padding-left: 0; display: none; }
    .f2057-btn {
        background: #ffe082 !important; color: #885c00 !important;
        font-size: 19px !important; font-weight: 900 !important;
        text-align: center; letter-spacing: 1px;
        box-shadow: 0 4px 18px #ffe08269;
        border: 2.5px solid #b8860b; margin-bottom: 6px;
        cursor: pointer; transition: background 0.18s, color 0.12s, border 0.18s;
    }
    .f2057-btn.open { border-radius: 12px 12px 0 0; }
    </style>
</head>
<body>
    <button id="theme-btn" title="Chuy·ªÉn Dark/Light mode"><i class="fa fa-moon"></i></button>
    <div class="report-banner">
        üìù M√É REPORT: {{ report }}
    </div>
    <div class="box">
        <div style="text-align: left;">
            <a href="{{ url_for('update', report=report) }}" class="back-btn" tabindex="0"
                aria-label="Quay l·∫°i ch·ªçn m·ª•c ki·ªÉm tra">
            <i class="fa fa-arrow-left"></i> 
                Quay l·∫°i trang s·∫£n ph·∫©m
            </a>
        </div>
        <h2>CH·ªåN M·ª§C KI·ªÇM TRA</h2>
        <div style="text-align:center;font-size:17px;margin-bottom:14px;color:#c49c48;font-weight:600;">
            {% if group == "ban_us" %}B√ÄN US
            {% elif group == "ban_eu" %}B√ÄN EU
            {% elif group == "ghe_us" %}GH·∫æ US
            {% elif group == "ghe_eu" %}GH·∫æ EU
            {% elif group == "tu_us" %}T·ª¶ US
            {% elif group == "tu_eu" %}T·ª¶ EU
            {% elif group == "giuong" %}GI∆Ø·ªúNG
            {% elif group == "guong" %}G∆Ø∆†NG
            {% elif group == "testkhac" %}TEST KH√ÅC
            {% else %}{{ group|upper }}
            {% endif %}
        </div>
        <div class="test-group-menu">
            {% for key, value in test_titles.items() %}
                {% if group == 'tu_us' and key == 'f2057' %}
                    <div>
                        <!-- Accordion F2057 -->
                        <button class="test-btn f2057-btn" type="button" onclick="toggleF2057(this)">
                            <i class="fa fa-flag" style="margin-right:8px; color:#b8860b;"></i>
                            <span style="font-size: 18px; font-weight: 700; letter-spacing: 1px;">{{ value.full }}</span>
                            <i class="fa fa-angle-down" style="margin-left: auto; color: #b8860b;"></i>
                        </button>
                        <div class="f2057-panel">
                            {% for fkey, fval in F2057_TEST_TITLES.items() %}
                            <div style="margin-bottom: 12px;">
                                <a class="test-btn" href="{{ url_for('test_group_item_dynamic', report=report, group=group, test_key=fkey) }}">
                                    {% if fval.full %}
                                        <b>{{ fval.full.split(':')[0] }}:</b> {{ fval.full.split(':', 1)[1]|default('', true) }}
                                    {% else %}
                                        {{ fval.full }}
                                    {% endif %}
                                </a>
                                {% set s = f2057_status.get(fkey, {}) %}
                                {% if s.status or s.comment or not s.status %}
                                <div>
                                    {% if s.status %}
                                    <div class="status-block">
                                        <span>
                                            Tr·∫°ng th√°i:
                                            {% if s.status == 'PASS' %}
                                                <span class="result-pass">PASS</span>
                                            {% elif s.status == 'FAIL' %}
                                                <span class="result-fail">FAIL</span>
                                            {% elif s.status == 'N/A' %}
                                                <span class="result-na">N/A</span>
                                            {% else %}
                                                {{ s.status }}
                                            {% endif %}
                                        </span><br>
                                        {% if s.comment %}
                                            <span class="comment">Ghi ch√∫: {{ s.comment }}</span><br>
                                        {% endif %}
                                        {% if s.status in ['PASS','FAIL'] and not s.has_img %}
                                            <span class="img-warn"><b>Ch∆∞a upload ·∫£nh ki·ªÉm th·ª≠!</b></span>
                                        {% endif %}
                                    </div>
                                    {% elif not s.status %}
                                    <div class="update-status">Ch∆∞a c·∫≠p nh·∫≠t</div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                {% elif not (group == 'tu_us' and key == 'f2057') %}
                    <!-- C√°c n√∫t b√¨nh th∆∞·ªùng -->
                    <div>
                        <a class="test-btn" href="{{ url_for('test_group_item_dynamic', report=report, group=group, test_key=key) }}">
                            {% if value.full %}
                                <b>{{ value.full.split(':')[0] }}:</b> {{ value.full.split(':', 1)[1]|default('', true) }}
                            {% else %}
                                {{ value.full }}
                            {% endif %}
                        </a>
                        {% set s = test_status.get(key, {}) %}
                        {% if s.status or s.comment or not s.status %}
                        <div>
                            {% if s.status %}
                            <div class="status-block">
                                <span>
                                    Tr·∫°ng th√°i:
                                    {% if s.status == 'PASS' %}
                                        <span class="result-pass">PASS</span>
                                    {% elif s.status == 'FAIL' %}
                                        <span class="result-fail">FAIL</span>
                                    {% elif s.status == 'N/A' %}
                                        <span class="result-na">N/A</span>
                                    {% else %}
                                        {{ s.status }}
                                    {% endif %}
                                </span><br>
                                {% if s.comment %}
                                    <span class="comment">Ghi ch√∫: {{ s.comment }}</span><br>
                                {% endif %}
                                {% if s.status in ['PASS','FAIL'] and not s.has_img %}
                                    <span class="img-warn"><b>Ch∆∞a upload ·∫£nh ki·ªÉm th·ª≠!</b></span>
                                {% endif %}
                            </div>
                            {% elif not s.status %}
                            <div class="update-status">Ch∆∞a c·∫≠p nh·∫≠t</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    <script>
        // Accordion x·ªï F2057
        function toggleF2057(btn) {
            let panel = btn.nextElementSibling;
            btn.classList.toggle('open');
            if (panel.style.display === "none" || !panel.style.display)
                panel.style.display = "block";
            else
                panel.style.display = "none";
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.test-btn, .back-btn, #theme-btn').forEach(function(btn) {
                btn.addEventListener('click', function (e) {
                    var circle = document.createElement("span");
                    circle.className = "ripple";
                    var rect = btn.getBoundingClientRect();
                    var size = Math.max(rect.width, rect.height) * 0.58;
                    circle.style.width = circle.style.height = size + 'px';
                    circle.style.left = (e.clientX - rect.left - size/2) + 'px';
                    circle.style.top = (e.clientY - rect.top - size/2) + 'px';
                    btn.appendChild(circle);
                    setTimeout(()=>circle.remove(), 340);
                });
            });
            if (localStorage.getItem("darkmode") === "true") {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
            }
            var themeBtn = document.getElementById('theme-btn');
            function syncDarkModeBtn() {
                var dark = document.body.classList.contains('dark');
                themeBtn.innerHTML = dark ? '<i class="fa fa-sun"></i>' : '<i class="fa fa-moon"></i>';
            }
            themeBtn.onclick = function() {
                var d = document.body.classList.toggle('dark');
                document.documentElement.classList.toggle('dark');
                localStorage.setItem("darkmode", d ? "true" : "false");
                syncDarkModeBtn();
            };
            syncDarkModeBtn();
        });
    </script>
</body>
</html>
